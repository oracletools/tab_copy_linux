<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright 2011 . All rights reserved.
     Author: AlexBuzunov@gmail.com (Alex Buzunov)
     Python Implementation of ETL pipeline
-->
<etldataflow name="SMC_SPOOL">
<globals>

	<!-- PIPELINE execution type
		 SYNC - synchronous, ANYNC - asynchronous 
	-->
	  <param name="FLOW_TYPE" value="ASYNC"></param>	

	  <param name="FIELD_TERMINATOR" value="|"></param>
	  <param name="LINE_TERMINATOR" value="''"></param>
	  
  
	  <param name="FROM_DB" value="%DL_GMAU%"></param>
	  <param name="FROM_DB1" value="%AB_SMARTP1B%"></param>
	  <param name="FROM_SCHEMA" value="DLROGMARWSMART"></param>
	  <param name="DB_CONNECTOR1" value="%DL_GMAU%"></param>
	  
	  
	   <!--will spool ALL records if LAME_DUCK=0-->
	  <param name="LAME_DUCK" value='0'></param>
	  <param name="ARRAYSIZE" value="5000"></param>
	  <param name="COPYCOMMIT" value="4"></param>
	  <!--sqlp attribute-->
		
		
	  <param name="SOURCE_FILE" value="--replaced from command line"></param>	
	  <param name="COB_YEAR" value="--replaced from command line"></param>

</globals>

 <worker name="tp_2">
  <exec_select>
    <table_utils   method="%DML_METHOD%" >
		<param name="DB_CONNECTOR" value="%CSMARTREF_SMARTQ1%"></param>
		<param name="SCHEMA_NAME" value="CSMARTREF"></param>
      <sql_template>
        <![CDATA[
drop table del_tmp_p_2
/
create table del_tmp_p_2 as
select --+ parallel_(12) index_ffs_(P PK_PRODUCT  ) drivin_site(ss)
P.SMCP    AS      SMC_PROD_ID,
      --SMC_SCR_KEY,
      --SMC_MSD_KEY,
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,
      -- (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,
      --E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,
       P.MARKET    AS      MKT,
      --C.CONTRACTTYPE    AS      CON_TYP,
      P.MARKETSEGMENT    AS      MKT_SEG,
--count(*)
P.ISINDEFAULT    AS      IS_IN_DFLT
from   C160970SMC.PRODUCT@gmail.com  P --, del_tmp_13_3 ss where p.SMCP=ss.smcp
where p.ROWID BETWEEN 'AACKUuAALAAJhvcAAo' AND 'AACKUuAAMAAIlhpAA4'
/
]]>
      </sql_template>
    </table_utils>
  </exec_select>
</worker> 

<worker1 name="t0">
  <exec_select>
    <table_utils   method="%DML_METHOD%" >		
		<param name="DB_CONNECTOR" value="%CSMARTREF_SMARTQ1%"></param>
		<param name="SCHEMA_NAME" value="CSMARTREF"></param>
      <sql_template>
        <![CDATA[

--select --+parallel(12) count(*) from del_tmp_13_3
--/

drop table del_tmp_13_3
/

create table del_tmp_13_3 as select /*+parallel(6)*/ SMCP, extract(year from DDAMODIFIEDTS) yr,extract(month from DDAMODIFIEDTS) mon from C160970SMC.SECURITY_LAST_UPDATE@gmail.com 
where DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM' and extract(year from DDAMODIFIEDTS)=2013 and extract(month from DDAMODIFIEDTS) = 3
/

]]>
      </sql_template>
    </table_utils>
  </exec_select>
</worker1>  


<worker1 name="t1">
  <exec_select>
    <table_utils   method="%DML_METHOD%" >		
		<param name="DB_CONNECTOR" value="%CSMARTREF_SMARTQ1%"></param>
		<param name="SCHEMA_NAME" value="CSMARTREF"></param>
      <sql_template>
        <![CDATA[

--select --+parallel(12) count(*) from del_tmp_12_8
--/

drop table del_tmp_12_8
/

create table del_tmp_12_8 as select /*+parallel(6)*/ SMCP, extract(year from DDAMODIFIEDTS) yr,extract(month from DDAMODIFIEDTS) mon from C160970SMC.SECURITY_LAST_UPDATE@gmail.com 
where DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM' and extract(year from DDAMODIFIEDTS)=2012 and extract(month from DDAMODIFIEDTS) = 8
/

]]>
      </sql_template>
    </table_utils>
  </exec_select>
</worker1>  


<worker1 name="t2">
  <exec_select>
    <table_utils   method="%DML_METHOD%" >		
		<param name="DB_CONNECTOR" value="%CSMARTREF_SMARTQ1%"></param>
		<param name="SCHEMA_NAME" value="CSMARTREF"></param>
      <sql_template>
        <![CDATA[

--select --+parallel(12) count(*) from del_tmp_13_1
--/

drop table del_tmp_13_1
/

create table del_tmp_13_1 as select /*+parallel(6)*/ SMCP, extract(year from DDAMODIFIEDTS) yr,extract(month from DDAMODIFIEDTS) mon from C160970SMC.SECURITY_LAST_UPDATE@gmail.com 
where DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM' and extract(year from DDAMODIFIEDTS)=2013 and extract(month from DDAMODIFIEDTS) = 1
/

]]>
      </sql_template>
    </table_utils>
  </exec_select>
</worker1>


<worker1 name="t3">
  <exec_select>
    <table_utils   method="%DML_METHOD%" >		
		<param name="DB_CONNECTOR" value="%CSMARTREF_SMARTQ1%"></param>
		<param name="SCHEMA_NAME" value="CSMARTREF"></param>
      <sql_template>
        <![CDATA[
--select --+parallel(12) count(*) from del_tmp_13_2
--/

drop table del_tmp_13_2
/

create table del_tmp_13_2 as select /*+parallel(6)*/ SMCP, extract(year from DDAMODIFIEDTS) yr,extract(month from DDAMODIFIEDTS) mon from C160970SMC.SECURITY_LAST_UPDATE@gmail.com 
where DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM' and extract(year from DDAMODIFIEDTS)=2013 and extract(month from DDAMODIFIEDTS) = 2
/

]]>
      </sql_template>
    </table_utils>
  </exec_select>
</worker1>




<worker1 name="SMC_3t">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
select SMCP from C160970SMC.SECURITY_LAST_UPDATE 
where DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM';
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>

<worker1 name="SMC_3t">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
select --+ no_parallel index_ffs_(P PK_PRODUCT  )
P.SMCP    AS      SMC_PROD_ID,
      --SMC_SCR_KEY,
      --SMC_MSD_KEY,
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      
      --E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,     
       P.MARKET    AS      MKT,      
      --C.CONTRACTTYPE    AS      CON_TYP,      
      P.MARKETSEGMENT    AS      MKT_SEG,
--count(*)
P.ISINDEFAULT    AS      IS_IN_DFLT
from   C160970SMC.PRODUCT  P, C160970SMC.ISSUER  I, C160970SMC.SECURITY_LAST_UPDATE  SLU
where  P.SMCP =SLU.SMCP and P.ISSUERSMCI = I.SMCI(+)
       --and p.ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA'
       and DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM'
       and substr(p.smcp,1,1)='6';
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>

<worker1 name="SMC_2t">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
		select * from (
SELECT --index(P PK_PRODUCT) --INDEX(I PK_ISSUER ) NO_MERGE(CX)  index(E PK_EXCHANGE_LISTING_INFO PK_EXCHANGE_LISTING_INFO )      index(s PK_SETTLEMENT) index(c PK_CONTRACT_INFORMATION  ) index(R PK_REDEMPTION) index(m PK_COMPLIANCE )      index(ii PK_INCOME_INFORMATION )
      /*+ PARALLEL(24) FULL_(P)  */
      P.SMCP    AS      SMC_PROD_ID,
      --SMC_SCR_KEY,
      --SMC_MSD_KEY,
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      
	  --(        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      --E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,
      --C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,
      --piv.GMI    AS      GMI_TKR,
       --TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,
      --piv.CSP    AS      CUSIP,
      --piv.ISN    AS      ISIN,
     --piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,
      --piv.BCSP    AS      BLMBRG_CUSIP,
      --(        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      --S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      --II.COUPONDIVIDENDRATE    AS        COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,
      --piv.BBT    AS      BLMBRG_TCKR,
      --MSD_SMBOL,
      --IRIC,
      'Automated'    AS      REC_SRC --,
      -- Release 3.8
      --S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      --S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
     -- S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      --piv.GRIC    AS      GRIC --,
     -- E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY
      FROM C160970SMC.PRODUCT  P,
      --ss where II.SMCP =ss.SMCP) II,
      --C160970SMC.ISSUER  I,
      C160970SMC.SECURITY_LAST_UPDATE  SLU
    WHERE  P.SMCP =SLU.SMCP
       -- ss WHERE S.SMCP =ss.SMCP) s,
      --and P.ISSUERSMCI = I.SMCI(+)
       --and p.ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA'
	   --and p.ROWID BETWEEN 'AACKUuAAYAAHqFpABE' AND 'AACKUuAAYAAJgi/AAr'
       and DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM'   
	 ) order by SMC_PROD_ID;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>

--1m9.221s 109M
<worker1 name="SMC_3t">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
select * from (		
SELECT --index(P PK_PRODUCT) --INDEX(I PK_ISSUER ) NO_MERGE(CX)  index(E PK_EXCHANGE_LISTING_INFO PK_EXCHANGE_LISTING_INFO )      index(s PK_SETTLEMENT) index(c PK_CONTRACT_INFORMATION  ) index(R PK_REDEMPTION) index(m PK_COMPLIANCE )      index(ii PK_INCOME_INFORMATION )
      /*+ PARALLEL(24) FULL_(P)  */
      P.SMCP    AS      SMC_PROD_ID,
      --SMC_SCR_KEY,
      --SMC_MSD_KEY,
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      --E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,
      --C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,
      --piv.GMI    AS      GMI_TKR,
       --TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,
      --piv.CSP    AS      CUSIP,
      --piv.ISN    AS      ISIN,
     --piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,
      --piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      --S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      --II.COUPONDIVIDENDRATE    AS        COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,
      --piv.BBT    AS      BLMBRG_TCKR,
      --MSD_SMBOL,
      --IRIC,
      'Automated'    AS      REC_SRC --,
      -- Release 3.8
      --S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      --S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
     -- S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      --piv.GRIC    AS      GRIC --,
     -- E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY
      FROM C160970SMC.PRODUCT  P,
      --ss where II.SMCP =ss.SMCP) II,
      C160970SMC.ISSUER  I,
      C160970SMC.SECURITY_LAST_UPDATE  SLU
    WHERE  P.SMCP =SLU.SMCP
       -- ss WHERE S.SMCP =ss.SMCP) s,
      and P.ISSUERSMCI = I.SMCI(+)
       --and p.ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA'
	  -- and p.ROWID BETWEEN 'AACKUuAAYAAHqFpABE' AND 'AACKUuAAYAAJgi/AAr'
       and DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM'   
	 ) order by SMC_PROD_ID;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>


-4m42.613s 649M
<worker1 name="SMC3">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
SELECT --index(P PK_PRODUCT) --INDEX(I PK_ISSUER ) NO_MERGE(CX)  index(E PK_EXCHANGE_LISTING_INFO PK_EXCHANGE_LISTING_INFO )      index(s PK_SETTLEMENT) index(c PK_CONTRACT_INFORMATION  ) index(R PK_REDEMPTION) index(m PK_COMPLIANCE )      index(ii PK_INCOME_INFORMATION )
      /*+ PARALLEL(6) FULL_(P)  */
      P.SMCP    AS      SMC_PROD_ID,
      --SMC_SCR_KEY,
      --SMC_MSD_KEY,
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,
      --piv.GMI    AS      GMI_TKR,
       TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,
      --piv.CSP    AS      CUSIP,
      --piv.ISN    AS      ISIN,
     --piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,
      --piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS        COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,
      --piv.BBT    AS      BLMBRG_TCKR,
      --MSD_SMBOL,
      --IRIC,
      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      --piv.GRIC    AS      GRIC --,
      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY
      FROM ( --SELECT * FROM C160970SMC.PRODUCT  P WHERE p.ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA'
	  --UNION ALL
	  SELECT  /*+  FULL_(P)  */ P.*, DDAMODIFIEDTS FROM C160970SMC.PRODUCT  P, C160970SMC.SECURITY_LAST_UPDATE  SLU
    WHERE p.ROWID BETWEEN 'AACKUuAAYAAHqFpABE' AND 'AACKUuAAYAAJgi/AAr'  AND P.SMCP =SLU.SMCP
	--and DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM'
	  ) P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION _dev II
      --(select II.* from
      C160970SMC.INCOME_INFORMATION II,
      --ss where II.SMCP =ss.SMCP) II,
      C160970SMC.ISSUER  I,
      --(select E.* from
      C160970SMC.EXCHANGE_LISTING_INFO  E,
      --ss where E.SMCP =ss.SMCP) E,
      --(select C.* from
      C160970SMC.CONTRACT_INFORMATION  C,
      --ss where C.SMCP =ss.SMCP) C,
      --(select M.* from
      C160970SMC.COMPLIANCE  M,
       --ss where M.SMCP =ss.SMCP) M,
      --(select R.* from
      C160970SMC.REDEMPTION  R,
      -- ss where R.SMCP =ss.SMCP) R,
      --(SELECT S.* FROM
       C160970SMC.SETTLEMENT  S
       -- ss WHERE S.SMCP =ss.SMCP) s,
      WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+)
      --AND P.SMCP = CX.SMCP(+)
      AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) --AND P.SMCP = piv.SMCP(+)
      AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+)     
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>


<worker1 name="SMC2">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
SELECT --index(P PK_PRODUCT) --INDEX(I PK_ISSUER ) NO_MERGE(CX)  index(E PK_EXCHANGE_LISTING_INFO PK_EXCHANGE_LISTING_INFO )      index(s PK_SETTLEMENT) index(c PK_CONTRACT_INFORMATION  ) index(R PK_REDEMPTION) index(m PK_COMPLIANCE )      index(ii PK_INCOME_INFORMATION )
      /*+ PARALLEL(2) FULL_(P)  */
      P.SMCP    AS      SMC_PROD_ID,      
      --SMC_SCR_KEY,      
      --SMC_MSD_KEY,     
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,      
      --piv.GMI    AS      GMI_TKR,     
       TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,      
      --piv.CSP    AS      CUSIP,      
      --piv.ISN    AS      ISIN,
     --piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,      
      --piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS        COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,      
      --piv.BBT    AS      BLMBRG_TCKR,      
      --MSD_SMBOL,      
      --IRIC,      
      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      --piv.GRIC    AS      GRIC --,     
      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY 
      FROM ( --SELECT * FROM C160970SMC.PRODUCT  P WHERE p.ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA' 
	  --UNION ALL
	  SELECT * FROM C160970SMC.PRODUCT  P WHERE p.ROWID BETWEEN 'AACKUuAAYAAHqFpABE' AND 'AACKUuAAYAAJgi/AAr'
	  ) P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION _dev II
      --(select II.* from 
      C160970SMC.INCOME_INFORMATION II, 
      --ss where II.SMCP =ss.SMCP) II,
      C160970SMC.ISSUER  I,
      --(select E.* from 
      C160970SMC.EXCHANGE_LISTING_INFO  E,
      --ss where E.SMCP =ss.SMCP) E,
      --(select C.* from 
      C160970SMC.CONTRACT_INFORMATION  C,
      --ss where C.SMCP =ss.SMCP) C,
      --(select M.* from 
      C160970SMC.COMPLIANCE  M,
       --ss where M.SMCP =ss.SMCP) M,
      --(select R.* from 
      C160970SMC.REDEMPTION  R,
      -- ss where R.SMCP =ss.SMCP) R,
      --(SELECT S.* FROM
       C160970SMC.SETTLEMENT  S,
       -- ss WHERE S.SMCP =ss.SMCP) s,
        (SELECT
        /*+ PARALLEL(SLU, 4) FULL(SLU)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE  SLU
      WHERE DDAMODIFIEDTS  > '07-AUG-12 03.19.13 AM'
      --between sysdate - 20 and sysdate -19
      ) ss
      WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+)
      --AND P.SMCP = CX.SMCP(+) 
      AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) --AND P.SMCP = piv.SMCP(+)
      AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+)
      AND P.SMCP =ss.SMCP       
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>

<worker1 name="SMC1">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
SELECT --index(P PK_PRODUCT) --INDEX(I PK_ISSUER ) NO_MERGE(CX)  index(E PK_EXCHANGE_LISTING_INFO PK_EXCHANGE_LISTING_INFO )      index(s PK_SETTLEMENT) index(c PK_CONTRACT_INFORMATION  ) index(R PK_REDEMPTION) index(m PK_COMPLIANCE )      index(ii PK_INCOME_INFORMATION )
      /*+ PARALLEL(2) FULL_(P)  */
      P.SMCP    AS      SMC_PROD_ID,      
      --SMC_SCR_KEY,      
      --SMC_MSD_KEY,     
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,      
      --piv.GMI    AS      GMI_TKR,     
       TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,      
      --piv.CSP    AS      CUSIP,      
      --piv.ISN    AS      ISIN,
     --piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,      
      --piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS        COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,      
      --piv.BBT    AS      BLMBRG_TCKR,      
      --MSD_SMBOL,      
      --IRIC,      
      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      --piv.GRIC    AS      GRIC --,     
      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY 
      FROM (SELECT * FROM C160970SMC.PRODUCT  P WHERE p.ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA' 
	  --UNION ALL
	  --SELECT * FROM C160970SMC.PRODUCT  P WHERE p.ROWID BETWEEN 'AACKUuAAYAAHqFpABE' AND 'AACKUuAAYAAJgi/AAr'
	  ) P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION _dev II
      --(select II.* from 
      C160970SMC.INCOME_INFORMATION II, 
      --ss where II.SMCP =ss.SMCP) II,
      C160970SMC.ISSUER  I,
      --(select E.* from 
      C160970SMC.EXCHANGE_LISTING_INFO  E,
      --ss where E.SMCP =ss.SMCP) E,
      --(select C.* from 
      C160970SMC.CONTRACT_INFORMATION  C,
      --ss where C.SMCP =ss.SMCP) C,
      --(select M.* from 
      C160970SMC.COMPLIANCE  M,
       --ss where M.SMCP =ss.SMCP) M,
      --(select R.* from 
      C160970SMC.REDEMPTION  R,
      -- ss where R.SMCP =ss.SMCP) R,
      --(SELECT S.* FROM
       C160970SMC.SETTLEMENT  S,
       -- ss WHERE S.SMCP =ss.SMCP) s,
        (SELECT
        /*+ PARALLEL(SLU, 4) FULL(SLU)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE  SLU
      WHERE DDAMODIFIEDTS  > '07-AUG-12 03.19.13 AM'
      --between sysdate - 20 and sysdate -19
      ) ss
      WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+)
      --AND P.SMCP = CX.SMCP(+) 
      AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) --AND P.SMCP = piv.SMCP(+)
      AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+)
      AND P.SMCP =ss.SMCP       
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>


<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 

SELECT --index(P PK_PRODUCT) --INDEX(I PK_ISSUER ) NO_MERGE(CX)  index(E PK_EXCHANGE_LISTING_INFO PK_EXCHANGE_LISTING_INFO )      index(s PK_SETTLEMENT) index(c PK_CONTRACT_INFORMATION  ) index(R PK_REDEMPTION) index(m PK_COMPLIANCE )      index(ii PK_INCOME_INFORMATION )
      /*+ PARALLEL(6) FULL_(P)  */
      P.SMCP    AS      SMC_PROD_ID,      
      --SMC_SCR_KEY,      
      --SMC_MSD_KEY,     
       P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,      
      --piv.GMI    AS      GMI_TKR,     
       TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,      
      --piv.CSP    AS      CUSIP,      
      --piv.ISN    AS      ISIN,
     --piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,      
      --piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS        COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,      
      --piv.BBT    AS      BLMBRG_TCKR,      
      --MSD_SMBOL,      
      --IRIC,      
      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      --piv.GRIC    AS      GRIC --,     
      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY 
      FROM C160970SMC.PRODUCT  P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION _dev II
      --(select II.* from 
      C160970SMC.INCOME_INFORMATION II, 
      --ss where II.SMCP =ss.SMCP) II,
      C160970SMC.ISSUER  I,
      --(select E.* from 
      C160970SMC.EXCHANGE_LISTING_INFO  E,
      --ss where E.SMCP =ss.SMCP) E,
      --(select C.* from 
      C160970SMC.CONTRACT_INFORMATION  C,
      --ss where C.SMCP =ss.SMCP) C,
      --(select M.* from 
      C160970SMC.COMPLIANCE  M,
       --ss where M.SMCP =ss.SMCP) M,
      --(select R.* from 
      C160970SMC.REDEMPTION  R,
      -- ss where R.SMCP =ss.SMCP) R,
      --(SELECT S.* FROM
       C160970SMC.SETTLEMENT  S,
       -- ss WHERE S.SMCP =ss.SMCP) s,
        (SELECT
        /*+ PARALLEL(SLU, 4) FULL(SLU)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE  SLU
      WHERE DDAMODIFIEDTS  > '07-AUG-12 03.19.13 AM'
      --between sysdate - 20 and sysdate -19
      ) ss
      WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+)
      --AND P.SMCP = CX.SMCP(+) 
      AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) --AND P.SMCP = piv.SMCP(+)
      AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+)
      AND P.SMCP =ss.SMCP
       and p.ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA'
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>


<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
	  <param name="FROM_DB" value="%CSMARTREF_SMARTQ1%"></param>
	  <param name="FROM_SCHEMA" value="CSMARTREF"></param>
	  <param name="DB_CONNECTOR" value="%CSMARTREF_SMARTQ1%"></param>	
      <sql_template>
        <![CDATA[ 
SELECT
      /*+ PARALLEL(4) FULL_(P) */
      P.SMCP    AS      SMC_PROD_ID,      SMC_SCR_KEY,      SMC_MSD_KEY,      P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,      piv.GMI    AS      GMI_TKR,      TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,      piv.CSP    AS      CUSIP,      piv.ISN    AS      ISIN,
      piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,      piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS      COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,      piv.BBT    AS      BLMBRG_TCKR,      MSD_SMBOL,      IRIC,      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      piv.GRIC    AS      GRIC,      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY FROM C160970SMC.PRODUCT@gmail.com  P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION _dev II
      C160970SMC.INCOME_INFORMATION@gmail.com  II,
      C160970SMC.ISSUER@gmail.com  I,
      C160970SMC.EXCHANGE_LISTING_INFO@gmail.com  E,
      C160970SMC.CONTRACT_INFORMATION@gmail.com  C,
      C160970SMC.COMPLIANCE@gmail.com  M,
      C160970SMC.REDEMPTION@gmail.com  R,
      (SELECT
        /*+ PARALLEL1 (CX,4) */
        SMCP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'FII'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_SCR_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'MSDC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_MSD_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SCSP'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SCR_CUSIP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'IRIC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS IRIC,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SMBS'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS MSD_SMBOL
      FROM C160970SMC.DEPOT_XREF@gmail.com  CX
      WHERE XREFCODE IN ( 'FII','MSDC','SCSP','IRIC','SMBS')
      GROUP BY SMCP
      ) CX,
      (SELECT
        /*+ PARALLEL1 (X,4) */
        X.SMCP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GMIT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GMI,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'ISN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS ISN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'RIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS RIC,
        MAX(
        CASE
          WHEN X.XREFCODE = 'SDL'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS SDL,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CCD'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CCD,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBPK'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBPK,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BUN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BUN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BCSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BCSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBT,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GRIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GRIC
      FROM C160970SMC.XREF@gmail.com  X
      WHERE DFLAG   = 'N'
      AND XREFCODE IN ('BUN','BCSP','BBPK','CCD','SDL','RIC','ISN','CSP','GMIT','BBT','GRIC')
      GROUP BY X.SMCP
      ) piv,
      C160970SMC.SETTLEMENT@gmail.com  S WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+) AND P.SMCP = CX.SMCP(+) AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) AND P.SMCP = piv.SMCP(+) AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+) AND P.SMCP IN
      (SELECT
        /*+ PARALLEL1(SLU, 4)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE@gmail.com  SLU
      WHERE DDAMODIFIEDTS > sysdate-10
      )
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>
--NO_PARALLEL FULL_(P) 1m27.011s
<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
SELECT
      /*+ PARALLEL(4) FULL_(P) */
      P.SMCP    AS      SMC_PROD_ID,      SMC_SCR_KEY,      SMC_MSD_KEY,      P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,      piv.GMI    AS      GMI_TKR,      TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,      piv.CSP    AS      CUSIP,      piv.ISN    AS      ISIN,
      piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,      piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS      COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,      piv.BBT    AS      BLMBRG_TCKR,      MSD_SMBOL,      IRIC,      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      piv.GRIC    AS      GRIC,      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY FROM C160970SMC.PRODUCT  P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION _dev II
      C160970SMC.INCOME_INFORMATION  II,
      C160970SMC.ISSUER  I,
      C160970SMC.EXCHANGE_LISTING_INFO  E,
      C160970SMC.CONTRACT_INFORMATION  C,
      C160970SMC.COMPLIANCE  M,
      C160970SMC.REDEMPTION  R,
      (SELECT
        /*+ PARALLEL1 (CX,4) */
        SMCP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'FII'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_SCR_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'MSDC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_MSD_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SCSP'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SCR_CUSIP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'IRIC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS IRIC,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SMBS'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS MSD_SMBOL
      FROM C160970SMC.DEPOT_XREF  CX
      WHERE XREFCODE IN ( 'FII','MSDC','SCSP','IRIC','SMBS')
      GROUP BY SMCP
      ) CX,
      (SELECT
        /*+ PARALLEL1 (X,4) */
        X.SMCP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GMIT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GMI,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'ISN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS ISN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'RIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS RIC,
        MAX(
        CASE
          WHEN X.XREFCODE = 'SDL'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS SDL,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CCD'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CCD,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBPK'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBPK,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BUN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BUN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BCSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BCSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBT,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GRIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GRIC
      FROM C160970SMC.XREF  X
      WHERE DFLAG   = 'N'
      AND XREFCODE IN ('BUN','BCSP','BBPK','CCD','SDL','RIC','ISN','CSP','GMIT','BBT','GRIC')
      GROUP BY X.SMCP
      ) piv,
      C160970SMC.SETTLEMENT  S WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+) AND P.SMCP = CX.SMCP(+) AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) AND P.SMCP = piv.SMCP(+) AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+) AND P.SMCP IN
      (SELECT
        /*+ PARALLEL1(SLU, 4)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE  SLU
      WHERE DDAMODIFIEDTS > sysdate -20
	  --'07-AUG-12 03.19.13 AM'
      )
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1	>

<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
with ss as (SELECT
        /*+ PARALLEL_(SLU, 4)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE  SLU
      WHERE DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM'
       )
select --+ parallel(12) FULL(P   ) index(I PK_ISSUER)
      P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY
      from (SELECT * FROM C160970SMC.PRODUCT P WHERE ROWID BETWEEN 'AACKUuAAfAAGrxFAAl' AND 'AACKUuAAfAAIEEgAAA') P --75.226.730
      ,C160970SMC.ISSUER  I
where P.ISSUERSMCI = I.SMCI(+) and
      P.SMCP IN
      (SELECT
        smcp from ss
      )
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1>



<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
	  <param name="FROM_DB1" value="%CSMARTREF_SMARTQ1%"></param>
	  <param name="FROM_SCHEMA1" value="CSMARTREF"></param>
	  <param name="DB_CONNECTOR1" value="%CSMARTREF_SMARTQ1%"></param>	
	  <param name="DB_LINK1" value="@gmail.com"></param>		  
	  <param name="DB_LINK" value=""></param>		  
      <sql_template>
        <![CDATA[ 		
select --+ parallel(24) index_ffs(P PK_PRODUCT  ) driving_site(P)
      p.smcp from C160970SMC.PRODUCT%DB_LINK% P --75.226.730
where P.SMCP IN
      (SELECT
        /*+ PARALLEL1(SLU, 4)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE  SLU
      WHERE DDAMODIFIEDTS > '07-AUG-12 03.19.13 AM'
      )
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1>


--+ PARALLEL FULL(P) parallel(R,4) parallel(P,4) parallel(I,4) parallel(E,8) parallel(S,4) driving_site(P) 
--9m17.332s 538K
<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
	  <param name="FROM_DB" value="%CSMARTREF_SMARTQ1%"></param>
	  <param name="FROM_SCHEMA" value="CSMARTREF"></param>
	  <param name="DB_CONNECTOR" value="%CSMARTREF_SMARTQ1%"></param>		
      <sql_template>
        <![CDATA[ 		
SELECT      
	  /*+ PARALLEL(24) FULL1(P)  */
      P.SMCP    AS      SMC_PROD_ID,      SMC_SCR_KEY,      SMC_MSD_KEY,      P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,      piv.GMI    AS      GMI_TKR,      TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,      piv.CSP    AS      CUSIP,      piv.ISN    AS      ISIN,
      piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,      piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS      COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,      piv.BBT    AS      BLMBRG_TCKR,      MSD_SMBOL,      IRIC,      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      piv.GRIC    AS      GRIC,      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY FROM C160970SMC.PRODUCT@gmail.com P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION@gmail.com II
      C160970SMC.INCOME_INFORMATION@gmail.com II,
      C160970SMC.ISSUER@gmail.com I,
      C160970SMC.EXCHANGE_LISTING_INFO@gmail.com E,
      C160970SMC.CONTRACT_INFORMATION@gmail.com C,
      C160970SMC.COMPLIANCE@gmail.com M,
      C160970SMC.REDEMPTION@gmail.com R,
      (SELECT
        /*+ PARALLEL (CX,4) */
        SMCP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'FII'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_SCR_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'MSDC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_MSD_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SCSP'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SCR_CUSIP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'IRIC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS IRIC,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SMBS'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS MSD_SMBOL
      FROM C160970SMC.DEPOT_XREF@gmail.com CX
      WHERE XREFCODE IN ( 'FII','MSDC','SCSP','IRIC','SMBS')
      GROUP BY SMCP
      ) CX,
      (SELECT
        /*+ PARALLEL (X,4) */
        X.SMCP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GMIT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GMI,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'ISN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS ISN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'RIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS RIC,
        MAX(
        CASE
          WHEN X.XREFCODE = 'SDL'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS SDL,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CCD'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CCD,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBPK'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBPK,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BUN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BUN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BCSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BCSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBT,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GRIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GRIC
      FROM C160970SMC.XREF@gmail.com X
      WHERE DFLAG   = 'N'
      AND XREFCODE IN ('BUN','BCSP','BBPK','CCD','SDL','RIC','ISN','CSP','GMIT','BBT','GRIC')
      GROUP BY X.SMCP
      ) piv,
      C160970SMC.SETTLEMENT@gmail.com S WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+) AND P.SMCP = CX.SMCP(+) AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) AND P.SMCP = piv.SMCP(+) AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+) AND P.SMCP IN
      (SELECT
        /*+ PARALLEL1(SLU, 4)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE@gmail.com SLU
      WHERE DDAMODIFIEDTS > sysdate-10
      )
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1>

--504k 30 sec
--parallel_(R,4) parallel_(P,4) parallel_(I,4) parallel_(E,8) parallel_(S,4) driving_site_(P) 
<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
SELECT
      /*+ PARALLEL(4) FULL(P) */
      P.SMCP    AS      SMC_PROD_ID,      SMC_SCR_KEY,      SMC_MSD_KEY,      P.SHORTDESCRIPTION    AS      PROD_SHRT_DESC,      P.DESCRIPTION    AS      PROD_LNG_DESC,      P.OPERATIONALINDICATOR    AS      OPER_IND,      P.ISDUMMYPRODUCT    AS      IS_DUMMY_PROD,      P.MARKETSECTORDESCRIPTION    AS      MKT_SECT_DESC,
      P.SECURITYTYPELEVEL1    AS      SCR_TYP_LVL_1,      P.SECURITYTYPELEVEL2    AS      SCR_TYP_LVL_2,      P.SERIES    AS      SERIES,      (        CASE        WHEN I.ISSUERCOUNTRYOFRISK IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRYOFRISK        END )    AS      ISS_CTRY,
      P.ISSUECURRENCY    AS      ISS_CCY,      E.INSTRUMENTLISTINGLEVEL    AS      INSM_LSTG_LVL,      P.MARKET    AS      MKT,      C.CONTRACTTYPE    AS      CON_TYP,      P.MARKETSEGMENT    AS      MKT_SEG,      piv.GMI    AS      GMI_TKR,      TO_CHAR ( R.CURRENTMATURITYDATE, 'MM' ) AS      MAT_MO,      TO_CHAR ( R.CURRENTMATURITYDATE, 'YYYY' ) AS      MAT_YR,      piv.CSP    AS      CUSIP,      piv.ISN    AS      ISIN,
      piv.RIC    AS      RIC,      piv.SDL    AS      SEDOL,      piv.CCD    AS      COM_CD,      piv.BBPK    AS      BLMBRG_PK,      piv.BUN    AS      BLMBRG_UNIQ_KEY,      M.NASDTRACEFLAG    AS      NASD_TRCE_FLAG,      P.ISINDEFAULT    AS      IS_IN_DFLT,      USER    AS      CRTD_BY,      systimestamp    AS      CRTD_TS,      USER    AS      LST_UPDT_BY,      systimestamp    AS      LST_UPDT_TS,      SCR_CUSIP,      piv.BCSP    AS      BLMBRG_CUSIP,
      (        CASE        WHEN I.ISSUERCOUNTRY IS NULL THEN          CASE          WHEN P.COUNTRY IS NULL THEN            'UNALLOCATED'          ELSE            P.COUNTRY          END        ELSE          I.ISSUERCOUNTRY        END )    AS      ORIG_ISS_CTRY,      'I'    AS      IND_KEY,      I.SMCI    AS      SMC_ISSUER_ID,      I.ISSUERCOUNTRYOFINCORPORATION    AS      ISSUER_CTRY_OF_INCORP,      I.ISSUERNAME    AS      SMC_ISSUER_NAM,      P.ISSUESTATUS    AS      PROD_ISSUE_STA,      P.SECURITYTYPELEVEL3    AS      SCR_TYP_LVL_3,
      S.ISDTCGLOBALLOCK    AS      GLBL_LCK_IND,      S.ISDTCCCHILL    AS      CHILLED_STATUS,
      -- Release 3.3 - Added for JIRA 155817-2673,155817-2519
      --START
      II.COUPONDIVIDENDRATE    AS      COUPON_DIV_RT,      II.COUPONDIVIDENDTYPE    AS      COUPON_DIV_TYP,      S.DAYSTOSETTLE    AS      DAYS_TO_SETL,      P.ISSUEDATE    AS      ISS_DT,      piv.BBT    AS      BLMBRG_TCKR,      MSD_SMBOL,      IRIC,      'Automated'    AS      REC_SRC,
      -- Release 3.8
      S.ISWTFAST    AS      IS_WTFAST,      S.IS3C7    AS      IS_3C7,      S.ISCEDEL    AS      IS_CEDEL,      S.ISPLEDGECHILL    AS      IS_PLEDGECHILL,      S.ISSEGREGATIONCHILL    AS      IS_SEGREGATIONCHILL,      S.ISFEDBOOKENTRY    AS      IS_FEDBOOKENTRY,      S.ISDEPOSITCHILL    AS      IS_DEPOSITCHIL,      S.ISDTCCDELETE    AS      Is_DTCCDelete,      S.ISNSCC    AS      Is_NSCC,      S.ISREORG    AS      Is_Reorg,      S.ISSEG100    AS      IS_SEG100,      S.ISCODFAST    AS      IS_CODFAST,
      S.ISCNSELIGIBLE    AS      IS_CNSELIGIBLE,      S.ISWTCHILL    AS      IS_WTCHILL,      S.ISINTERDEPOSITORYCHILL    AS      IS_INTERDEPOSITORYCHILL,      S.PTMLEVYINDICATOR    AS      PTMLEVY_INDICATOR,      S.ISDTCREGISTERED    AS      IS_DTCREGISTERED,      S.ISDTC    AS      IS_DTC,      S.ISDTCCINTERIMSTATUS    AS      IS_DTCCINTERIMSTATUS,      S.ISCODCHILL    AS      IS_CODCHILL,      S.ISCOMMUNICATION    AS      IS_COMMUNICATION,      S.ISDOCHILL    AS      IS_DOCHILL,      S.ISCUSTODYSERVICE    AS      IS_CUSTODYSERVICE,      S.ISEUROCLEAR    AS      IS_EUROCLEAR,
      S.ISSALOMON    AS      IS_SALOMON,      S.ISREORGDEPOSIT    AS      IS_REORGDEPOSIT,      S.UKSTAMPDUTYMARKER    AS      UKSTAMPDUTY_MARKET,      S.ISDTCFROZEN    AS      IS_DTCFROZEN,      S.ISFEDFUND    AS      IS_FEDFUND,      S.ISBOOKENTRY    AS      IS_BOOKENTRY,      S.ISEDSELIGIBLE    AS      IS_EDSELIGIBLE,
      --END
      --Release4.1
      piv.GRIC    AS      GRIC,      E.ISGLOBALPRIMARY    AS      IS_GLOBALPRIMARY FROM C160970SMC.PRODUCT  P,
      -- Release 3.3 - Added for JIRA 155817-2519 added C160970SMC.INCOME_INFORMATION _dev II
      C160970SMC.INCOME_INFORMATION  II,
      C160970SMC.ISSUER  I,
      C160970SMC.EXCHANGE_LISTING_INFO  E,
      C160970SMC.CONTRACT_INFORMATION  C,
      C160970SMC.COMPLIANCE  M,
      C160970SMC.REDEMPTION  R,
      (SELECT
        /*+ PARALLEL (CX,4) */
        SMCP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'FII'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_SCR_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'MSDC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SMC_MSD_KEY,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SCSP'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS SCR_CUSIP,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'IRIC'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS IRIC,
        MAX(
        CASE
          WHEN CX.XREFCODE = 'SMBS'
          THEN CX.XREFVALUE
          ELSE NULL
        END) AS MSD_SMBOL
      FROM C160970SMC.DEPOT_XREF  CX
      WHERE XREFCODE IN ( 'FII','MSDC','SCSP','IRIC','SMBS')
      GROUP BY SMCP
      ) CX,
      (SELECT
        /*+ PARALLEL (X,4) */
        X.SMCP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GMIT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GMI,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'ISN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS ISN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'RIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS RIC,
        MAX(
        CASE
          WHEN X.XREFCODE = 'SDL'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS SDL,
        MAX(
        CASE
          WHEN X.XREFCODE = 'CCD'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS CCD,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBPK'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBPK,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BUN'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BUN,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BCSP'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BCSP,
        MAX(
        CASE
          WHEN X.XREFCODE = 'BBT'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS BBT,
        MAX(
        CASE
          WHEN X.XREFCODE = 'GRIC'
          THEN X.XREFVALUE
          ELSE NULL
        END) AS GRIC
      FROM C160970SMC.XREF  X
      WHERE DFLAG   = 'N'
      AND XREFCODE IN ('BUN','BCSP','BBPK','CCD','SDL','RIC','ISN','CSP','GMIT','BBT','GRIC')
      GROUP BY X.SMCP
      ) piv,
      C160970SMC.SETTLEMENT  S WHERE P.ISSUERSMCI = I.SMCI(+)  AND P.SMCP = E.SMCP(+) AND P.SMCP = R.SMCP(+) AND P.SMCP = CX.SMCP(+) AND P.SMCP = C.SMCP(+) AND P.SMCP = M.SMCP(+) AND P.SMCP = piv.SMCP(+) AND P.SMCP = S.SMCP(+) AND P.SMCP=II.SMCP(+) AND P.SMCP IN
      (SELECT
        /*+ PARALLEL1(SLU, 4)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE  SLU
      WHERE DDAMODIFIEDTS > sysdate-10
      )
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1>

--104k 1 min
<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
SELECT
        /*+ PARALLEL (X,8) FULL(X) */
        X.SMCP,
           X.XREFCODE,
           X.XREFVALUE
      FROM C160970SMC.XREF --SAMPLE BLOCK (1)
      X
      WHERE DFLAG   = 'N'
      AND XREFCODE IN ('BUN','BCSP','BBPK','CCD','SDL','RIC','ISN','CSP','GMIT','BBT','GRIC')
      and X.SMCP in
      (SELECT
        /*+ PARALLEL(SLU, 4) FULL(SLU)*/
        smcp
      FROM C160970SMC.SECURITY_LAST_UPDATE SLU
      WHERE DDAMODIFIEDTS > sysdate-10
      )
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1>

 --31mb 1 min
<worker1 name="SMC">
  <exec_query_spool>
    <table_utils 	method="%QUERY_SPOOL_METHOD%" >
     	<param name="IF_COMPRESSED_SPOOL" value="0"></param>
      <sql_template>
        <![CDATA[ 
SELECT
        /*+ PARALLEL (X,4) FULL(X) */
        X.SMCP,
           X.XREFCODE,
           X.XREFVALUE
      FROM C160970SMC.XREF SAMPLE BLOCK (1)
      X
      WHERE DFLAG   = 'N'
      AND XREFCODE IN ('BUN','BCSP','BBPK','CCD','SDL','RIC','ISN','CSP','GMIT','BBT','GRIC')
	 ;
]]>
      </sql_template>
    </table_utils>
  </exec_query_spool>
</worker1>



</etldataflow>
